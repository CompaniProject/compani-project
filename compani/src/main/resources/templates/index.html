<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{/layout/layout}">
<th:block layout:fragment="content">
    <div class="content-body">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#workModal">Launch
            workModal
        </button>

        <div class="modal fade" id="workModal" tabindex="-1" aria-labelledby="sidebarModalLabel" aria-hidden="true"
            style="overflow:auto;">
            <div class="modal-dialog">
                <div class="modal-content"
                    style="box-shadow: 0 3px 15px 0 rgba(0, 0, 0, 0.15); width: 780px; top: calc(( 86vh - 601px)/2); height: 671px; opacity: 1; z-index: 500; overflow: auto;">
                    <!-- 모달 헤더 부분 -->
                    <div class="modal-header">
                        <div class="ContentTitleBox">
                            <div class="ContentImg" style="background-image: url(/images/tab_issue.png);"></div>
                            <p class="ContentText">이슈</p>
                        </div>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"
                            style="margin: 0; padding: 0;"></button>
                    </div>
                    <div class="modal-content-container">
                        <div class="workModalTab">
                            <ul>
                                <li><i class="ModalTab tab_basic"></i> <span class="tooltip">기본정보</span></li>
                                <li><i class="ModalTab tab_file"></i> <span class=" tooltip">자료관리</span></li>
                                <li><i class="ModalTab tab_issue"></i> <span class="tooltip">이슈</span></li>
                                <li><i class="ModalTab tab_log"></i> <span class="tooltip">로그</span></li>
                            </ul>
                        </div>
                        <div class="modal-body">
                            <div class="workModalContentBack">
                                <div class="workModalContentSlider">
                                    <div class="workModalContent issueContent">
                                        <div class="workModalBussTitle">
                                            <div class="ModalTitle">
                                                <div class="ModalProjectNameBox">
                                                    <div id="ProjectLink">
                                                        #<span></span>
                                                        <p class="textEllipsis" th:text="${issueList[0].prjtNm}" />
                                                    </div>
                                                </div>
                                                <div class="ModalBussNameBox Edit">
                                                    <div class="ModalBussNameBack">
                                                        <textarea id="ModalUpdateBussName"
                                                            th:text="${issueList[0].bussNm}" readonly maxlength="200"
                                                            style="height: 34px;"></textarea>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="ModalInfo">
                                            <div class="FixOnTop ModalTopBar">
                                                <div class="IssueTopBar">
                                                    <div></div>
                                                    <div class="TobBarIssueControlArea">

                                                        <div class="SearchBox">
                                                            <label for="SearchToggleCheckBox"
                                                                th:attr="onclick='issuePaging(1)'"></label> <input
                                                                type="hidden" id="keyword" name="keyword" value="전체">
                                                            <div class="SearchInputBox" style="width: 270px;">
                                                                <div>
                                                                    <div class="issue-selectBox" style="width: 100px;">
                                                                        <div class="issue-selected" id="issue-selected">
                                                                            <div class="issue-selected-value">전체</div>
                                                                            <div class="arrow"></div>
                                                                        </div>
                                                                        <ul class="issue-select-ul"
                                                                            style="width: 100px; top: 20%; display: none;">
                                                                            <li class="issue-select-option"
                                                                                data-value="전체">전체
                                                                            </li>
                                                                            <li class="issue-select-option"
                                                                                data-value="작성자">작성자
                                                                            </li>
                                                                            <li class="issue-select-option"
                                                                                data-value="제목">제목
                                                                            </li>
                                                                        </ul>
                                                                    </div>
                                                                </div>
                                                                <input class="SearchInputModalView" id="search"
                                                                    name="search" type="text"
                                                                    placeholder="검색어를 입력하세요."><span
                                                                    class="DeleteSearchWord"></span>
                                                            </div>
                                                        </div>

                                                        <button class="postWritingBox">
                                                            <span></span>
                                                            <p>글쓰기</p>
                                                        </button>

                                                    </div>
                                                </div>
                                            </div>
                                            <div class="ModalInfoArea IssueInfoArea">

                                                <div class="col-lg-6" style="width: 100%; max-width: 100%;">

                                                    <div class="table-responsive">
                                                        <table class="table table-hover">
                                                            <thead>
                                                                <tr>
                                                                    <th style="font-weight: normal;">종류</th>
                                                                    <th style="font-weight: normal;">제목</th>
                                                                    <th style="font-weight: normal;">이름</th>
                                                                    <th style="font-weight: normal;">상태</th>
                                                                    <th style="font-weight: normal;">우선순위</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="issueLists">
                                                                <th:block th:each="issueList : ${issueList}">
                                                                    <tr
                                                                        th:onclick="viewIssueInfo([[${issueList.issuNo}]])">
                                                                        <th th:if="${issueList.issuKnd == '0L1'}"><span
                                                                                class="badge badge-danger"
                                                                                th:text="버그"></span></th>
                                                                        <th th:if="${issueList.issuKnd == '0L2'}"><span
                                                                                class="badge badge-warning"
                                                                                th:text="개선사항"></span></th>
                                                                        <th th:if="${issueList.issuKnd == '0L3'}"><span
                                                                                class="badge badge-info"
                                                                                th:text="새기능"></span></th>
                                                                        <th th:if="${issueList.issuKnd == '0L4'}"><span
                                                                                class="badge badge-light"
                                                                                th:text="업무"></span></th>
                                                                        <td th:text="${issueList.issuTtl}"></td>
                                                                        <td th:text="${issueList.membId}"></td>
                                                                        <th th:if="${issueList.issuSt == '0E1'}"><span
                                                                                class="badge badge-pill badge-success"
                                                                                th:text="해결"></span></th>
                                                                        <th th:if="${issueList.issuSt == '0E2'}"><span
                                                                                class="badge badge-pill badge-dark"
                                                                                th:text="미해결"></span>
                                                                        </th>
                                                                        <th th:if="${issueList.issuSt == '0E3'}">
                                                                            <span
                                                                                class="badge badge-pill badge-secondary"
                                                                                th:text="해결불가"></span>
                                                                        </th>

                                                                        <th th:if="${issueList.issuRank == '0G1'}"><span
                                                                                class="badge badge-primary"
                                                                                th:text="매우높음"></span></th>
                                                                        <th th:if="${issueList.issuRank == '0G2'}"><span
                                                                                class="badge badge-secondary"
                                                                                th:text="높음"></span></th>
                                                                        <th th:if="${issueList.issuRank == '0G3'}"><span
                                                                                class="badge badge-success"
                                                                                th:text="보통"></span></th>
                                                                        <th th:if="${issueList.issuRank == '0G4'}"><span
                                                                                class="badge badge-warning"
                                                                                th:text="낮음"></span></th>
                                                                        <th th:if="${issueList.issuRank == '0G5'}"><span
                                                                                class="badge badge-danger"
                                                                                th:text="매우낮음"></span></th>
                                                                    </tr>
                                                                </th:block>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="paginate-container d-none d-sm-flex flex-sm-justify-center">
                                            <div role="navigation" aria-label="Pagination" class="pagination">

                                                <a id="previous_page"
                                                    th:classappend="${issue.prePage == 0} ? 'disabled'"
                                                    th:attr="onclick='issuePaging(\'' + ${issue.prePage} + '\')'">Previous</a>
                                                <a class="cur_page"
                                                    th:each="page: ${#numbers.sequence(issue.navigateFirstPage, issue.navigateLastPage)}"
                                                    th:text="${page}"
                                                    th:attr="onclick='issuePaging(\'' + ${page} + '\')'"></a>
                                                <a id="next_page" th:classappend="${issue.nextPage == 0} ? 'disabled'"
                                                    th:attr="onclick='issuePaging(\'' + ${issue.nextPage} + '\')'">Next</a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- @@@@@@@@@@@@@@@@@@@@@@@@여기서 부터 이슈 등록 폼@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
                            <div class="modalIssueInsertForm" style="display: none">

                                <div class="modalInsertContent">
                                    <div class="issueInsertContentTopBar">
                                        <span class="cancelWriting"></span>
                                        <button type="button" class="completeWriting">등록</button>
                                    </div>
                                </div>
                                <div class="issueNameEdit">
                                    <div class="issueNameBack">
                                        <textarea class="modalIssueNameUpdate" id="issuTtlVal" maxlength="200"
                                            style="height: 34px;" placeholder="제목을 입력하세요."></textarea>
                                    </div>
                                </div>
                                <hr style="margin: 0; height: 2px; background-color: #eaeaea; width: 608px;">
                                <!--  이슈 종류, 이슈 중요도-->
                                <div class="issueKnd">
                                    <p>종류</p>
                                    <div class="dropBoxArea">
                                        <div class="basic-dropdown" style="display: inline;">
                                            <div class="dropdown">
                                                <button type="button" id="issuKndVal" name="issuKndVal"
                                                    class="badge badge-dark" data-toggle="dropdown">선택
                                                </button>
                                                <div class="dropdown-menu" style="cursor: pointer;">
                                                    <a class="dropdown-item"><span
                                                            class="badge badge-pill badge-warning">개선사항</span></a>
                                                    <a class="dropdown-item"><span
                                                            class="badge badge-pill badge-info">새기능</span></a> <a
                                                        class="dropdown-item"><span
                                                            class="badge badge-pill badge-light">업무</span></a>
                                                    <a class="dropdown-item"><span
                                                            class="badge badge-pill badge-danger">버그</span></a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="issueRank">
                                        <p>중요도</p>
                                        <div class="dropBoxArea">
                                            <div class="basic-dropdown">
                                                <div class="dropdown">
                                                    <button type="button" class="badge badge-dark"
                                                        data-toggle="dropdown" id="issuRankVal">선택
                                                    </button>
                                                    <div class="dropdown-menu" style="cursor: pointer;">
                                                        <a class="dropdown-item"><span
                                                                class="badge badge-primary">매우높음</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-secondary">높음</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-success">보통</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-warning">낮음</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-danger">매우낮음</span></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="writingContent">
                                    <div class="writingSection">
                                        <div class="sectionTitle">
                                            <p class="sectionTitleText" id="issuCntnVal">내용</p>
                                        </div>

                                        <div id="editor" style="width: 630px;"></div>

                                    </div>

                                    <div class="attachSection">
                                        <div class="sectionTitle">
                                            <p class="sectionTitleText">파일</p>
                                            <div class="LoadBtn upload">
                                                <span></span>
                                                <p>파일 업로드</p>
                                                <input type="file" class="real-upload" id="files" name="files" multiple
                                                    onchange="addIssueFile(this);" style="display: none;">
                                            </div>
                                        </div>
                                        <div class="fileupload dz">
                                            <div class="dz-message" style="width: 630px;">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>파일명</th>
                                                            <th>크기</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="issueFileList">
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="hashtagSection">
                                        <div class="sectionTitle">
                                            <p class="sectionTitleText">해시태그</p>
                                        </div>
                                        <div class="hashtagContent" style="width: 630px;">
                                            <div class="hashtagList">
                                                <div class="tagBox task" title="업무">
                                                    <p>#</p>
                                                    <span class="Ready"></span>
                                                    <p class="textEllipsis">업무</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--  취소 확인하는 모달  -->
                                <div class="modal fade" id="cancelConfirmationModal" tabindex="-1"
                                    style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header" style="border-bottom: none;">
                                                <button type="button" class="close" data-dismiss="modal"
                                                    style="margin: 0; padding: 0;" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body" id="cancelConfirmationModalBody">
                                                <img class="cancelWarning"> <span id="modal-meg" class="notice_msg">현재
                                                    작성중인
                                                    글은 저장되지 않습니다.<br> 뒤로
                                                    가시겠습니까?
                                                </span>
                                            </div>
                                            <div class="modal-footer" style="border-top: none;">
                                                <button type="button" class="btn btn-danger btn-sm" id="cancelCancel">취소
                                                </button>
                                                <button type="button" class="btn btn-light btn-sm" id="confirmCancel">확인
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--  취소 확인 하는 모달 END -->

                                <!-- 종류, 제목, 중요도가 다 입력되지 않았을 때  -->
                                <div class="modal fade" id="checkingInput" tabindex="-1"
                                    style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header" style="border-bottom: none;">
                                                <button type="button" class="close" data-dismiss="modal"
                                                    style="margin: 0; padding: 0;" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body" id="cancelConfirmationModalBody">
                                                <img class="cancelWarning"> <span id="modal-meg" class="notice_msg">제목,
                                                    종류, 중요도를 입력하세요!<br>
                                                </span>
                                            </div>
                                            <div class="modal-footer" style="border-top: none;">
                                                <button type="button" class="btn btn-info btn-sm"
                                                    id="confirmCheckingInput" style="margin: auto;">확인
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- END -->
                            </div>
                            <!-- @@@@@@@@@@@@@@@@@@@@@@@@이슈 등록폼 END@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->

                            <!-- 이슈 상세보기  시작!!!!! -->
                            <div class="modalIssueInfoForm" style="display: none;">
                                <div class="modalIssueInfoContent">
                                    <div class="issueInfoContentTopBar">
                                        <span class="returnIssueList" onclick="returnIssueList()"></span>
                                        <button type="button" class="issueEditing" onclick="switchEditForm()">수정
                                        </button>
                                        <button type="button" class="issueDeleting" onclick="deleteIssue()">삭제</button>
                                    </div>

                                    <div class="issueNameInfo">
                                        <div class="issueNames">
                                            <textarea class="modalIssueName" maxlength="200" style="height
											: 34px;" readonly></textarea>
                                        </div>
                                    </div>
                                    <hr style="margin: 0; height: 2px; background-color: #eaeaea; width: 608px;">
                                    <div class="read-content">
                                        <div class="media pt-5">
                                            <img class="mr-3 rounded-circle" src="images/avatar/1.jpg">
                                            <div class="media-body" style="margin-right: 50px; flex: 0;">
                                                <h5 class="m-b-3"></h5>
                                                <p class="m-b-2" style="width: 75px;">2023/10/24</p>

                                            </div>
                                            <div class="issueRankInfo">
                                            </div>
                                            <div class="issueKndInfo">
                                            </div>
                                            <div class="issueStInfo">
                                            </div>
                                        </div>
                                        <hr style="margin:0 ; height: 1px; background-color: #eaeaea; width: 608px;">
                                        <div class="card-body">
                                            <div id="viewer"></div>
                                        </div>
                                        <h6 class="p-t-15" style="display: inline-block; padding: 3px; "><i
                                                class="fa fa-download mb-2"></i> 첨부파일 <span id="countFile"></span></h6>
                                        <h6 class="p-t-16"
                                            style="display: inline-block; margin-left: 20px; padding: 3px; "><i
                                                class="fa fa-comment mb-2" style="margin-right: 5px;"></i>댓글 <span
                                                id="countReply"></span></h6>
                                        <hr style="margin: 0; height: 1px; background-color: #eaeaea; width: 608px;">

                                        <div class="issueInfoFileList" style="display: none;">
                                            <div class="list-message" style="width: 630px;">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>파일명</th>
                                                            <th>크기</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="issueInfoFiles">
                                                        <tr class="InfoFilesEmpty">
                                                            <td style="color: rgb(168, 168, 168);">등록된 파일이 없습니다.</td>
                                                            <td></td>
                                                            <td></td>
                                                        </tr>
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                        <div class="issueInfoCommentList" style="display: none;">
                                            <div class="IssueReviews">

                                            </div>
                                            <!-- 이슈 댓글 작성 -->
                                            <div class="issueReply__details__form">
                                                <div class="issueReply__section-title">
                                                    <h5>댓글<i id="counter">0/300자</i></h5>
                                                </div>
                                                <form action="#">
                                                    <textarea id="issueReplyCntn" name="issueReplyCntn"
                                                        onkeyup="countingLength(this);"
                                                        placeholder="댓글을 입력하세요"></textarea>

                                                    <button type="button" id="issueReplySave" onclick="saveReply();"><i
                                                            class="fa fa-location-arrow"></i>등록
                                                    </button>
                                                </form>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- 이슈 상세보기 END!!!!! -->

                            <!-- @@@@@@@@@@@@@@@@@@@@@@@@여기서 부터 이슈 수정 폼@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
                            <div class="modalIssueEditForm" style="display: none">

                                <div class="modalEditContent">
                                    <div class="issueEditContentTopBar">
                                        <span class="cancelEditing"></span>
                                        <button type="button" class="completeEditing">수정</button>
                                    </div>
                                </div>
                                <div class="editIssueName">
                                    <div class="editIssueNameBack">
                                        <textarea class="modalIssueNameEdit" id="editIssuTtlVal" maxlength="200"
                                            style="height: 34px;"></textarea>
                                    </div>
                                </div>
                                <hr style="margin: 0; height: 2px; background-color: #eaeaea; width: 608px;">
                                <!--  이슈 종류, 이슈 중요도-->
                                <div class="editIssueKnd">
                                    <p>종류</p>
                                    <div class="dropBoxArea">
                                        <div class="basic-dropdown" style="display: inline;">
                                            <div class="dropdown">
                                                <button type="button" id="editIssuKndVal" class="badge badge-dark"
                                                    data-toggle="dropdown"></button>
                                                <div class="dropdown-menu" style="cursor: pointer;">
                                                    <a class="dropdown-item"><span
                                                            class="badge badge-pill badge-warning">개선사항</span></a>
                                                    <a class="dropdown-item"><span
                                                            class="badge badge-pill badge-info">새기능</span></a> <a
                                                        class="dropdown-item"><span
                                                            class="badge badge-pill badge-light">업무</span></a>
                                                    <a class="dropdown-item"><span
                                                            class="badge badge-pill badge-danger">버그</span></a>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="editIssueSt">
                                        <p>상태</p>
                                        <div class="dropBoxArea">
                                            <div class="basic-dropdown" style="display: inline;">
                                                <div class="dropdown">
                                                    <button type="button" id="editIssuStVal" class="badge badge-dark"
                                                        data-toggle="dropdown"></button>
                                                    <div class="dropdown-menu" style="cursor: pointer;">
                                                        <a class="dropdown-item"><span
                                                                class="badge badge-pill badge-warning">해결</span></a>
                                                        <a class="dropdown-item"><span
                                                                class="badge badge-pill badge-info">미해결</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-pill badge-light">해결불가</span></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="editIssueRank">
                                        <p>중요도</p>
                                        <div class="dropBoxArea">
                                            <div class="basic-dropdown">
                                                <div class="dropdown">
                                                    <button type="button" class="badge badge-dark"
                                                        data-toggle="dropdown" id="editIssuRankVal"></button>
                                                    <div class="dropdown-menu" style="cursor: pointer;">
                                                        <a class="dropdown-item"><span
                                                                class="badge badge-primary">매우높음</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-secondary">높음</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-success">보통</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-warning">낮음</span></a> <a
                                                            class="dropdown-item"><span
                                                                class="badge badge-danger">매우낮음</span></a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="editingContent">
                                    <div class="editingSection">
                                        <div class="sectionTitle">
                                            <p class="sectionTitleText">내용</p>
                                        </div>

                                        <div id="editorEditing" style="width: 630px;"></div>

                                    </div>

                                    <div class="editingAttachSection">
                                        <div class="sectionTitle">
                                            <p class="sectionTitleText">파일</p>
                                            <div class="editingLoadBtn upload">
                                                <span></span>
                                                <p>파일 업로드</p>
                                                <input type="file" class="editReal-upload" id="editFiles"
                                                    name="editFiles" multiple onchange="addIssueFileE(this);"
                                                    style="display: none;">
                                            </div>
                                        </div>
                                        <div class="fileupload dz">
                                            <div class="dz-message" style="width: 630px;">
                                                <table class="table">
                                                    <thead>
                                                        <tr>
                                                            <th>파일명</th>
                                                            <th>크기</th>
                                                            <th></th>
                                                        </tr>
                                                    </thead>
                                                    <tbody id="editIssueFileList">
                                                    </tbody>
                                                </table>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="editHashtagSection">
                                        <div class="sectionTitle">
                                            <p class="sectionTitleText">해시태그</p>
                                        </div>
                                        <div class="editHashtagContent" style="width: 630px;">
                                            <div class="editHashtagList">
                                                <div class="editTagBox task" title="업무">
                                                    <p>#</p>
                                                    <span class="Ready"></span>
                                                    <p class="editTextEllipsis">업무</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--  취소 확인하는 모달  -->
                                <div class="modal fade" id="cancelEditConfirmationModal" tabindex="-1"
                                    style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header" style="border-bottom: none;">
                                                <button type="button" class="close" data-dismiss="modal"
                                                    style="margin: 0; padding: 0;" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body" id="cancelEditConfirmationModalBody">
                                                <img class="cancelWarning">
                                                <span id="modal-meg" class="notice_msg">
                                                    현재 수정중인 글은 저장되지 않습니다.<br> 뒤로 가시겠습니까?
                                                </span>
                                            </div>
                                            <div class="modal-footer" style="border-top: none;">
                                                <button type="button" class="btn btn-danger btn-sm"
                                                    id="cancelEditCancel">취소
                                                </button>
                                                <button type="button" class="btn btn-light btn-sm"
                                                    id="confirmEditCancel">확인
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!--  취소 확인 하는 모달 END -->

                                <!-- 종류, 제목, 중요도가 다 입력되지 않았을 때  -->
                                <div class="modal fade" id="editCheckingInput" tabindex="-1"
                                    style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header" style="border-bottom: none;">
                                                <button type="button" class="close" data-dismiss="modal"
                                                    style="margin: 0; padding: 0;" aria-label="Close"></button>
                                            </div>
                                            <div class="modal-body" id="editConfirmationModalBody">
                                                <img class="cancelWarning"> <span id="modal-meg" class="notice_msg">제목
                                                    을 입력하세요!<br>
                                                </span>
                                            </div>
                                            <div class="modal-footer" style="border-top: none;">
                                                <button type="button" class="btn btn-info btn-sm"
                                                    id="confirmEditCheckingInput" style="margin: auto;">확인
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- END -->
                            </div>
                            <!-- @@@@@@@@@@@@@@@@@@@@@@@@이슈 수정폼 END@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->

                            <!--  이슈 삭제 시 경고창 -->
                            <div class="modal fade" id="delConfirmationModal" tabindex="-1"
                                style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header" style="border-bottom: none;">
                                            <button type="button" class="close" data-dismiss="modal"
                                                style="margin: 0; padding: 0;" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body" id="delConfirmationModalBody">
                                            <img class="cancelWarning"> <span id="modal-meg" class="notice_msg">
                                                정말 삭제하시겠습니까?
                                            </span>
                                        </div>
                                        <div class="modal-footer" style="border-top: none;">
                                            <button type="button" class="btn btn-danger btn-sm" id="delCancel">취소
                                            </button>
                                            <button type="button" class="btn btn-light btn-sm" id="delConfirm">확인
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!--  이슈 삭제 시 경고창 END -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script th:inline="javascript">

        // 이슈 수정 폼
        function switchEditForm() {

            const issuNo = $('.modalIssueName').data('issuNo');

            $.ajax({
                url: '/ModalIssueInfo?issuNo=' + issuNo,
                type: 'get'
            })
                .done(function (response) {
                    var issueEditForm = document.querySelector('.modalIssueEditForm');
                    var infoForm = document.querySelector('.modalIssueInfoForm');
                    var kndVal = document.getElementById('editIssuKndVal');
                    var stVal = document.getElementById('editIssuStVal');
                    var rankVal = document.getElementById('editIssuRankVal');

                    if (issueEditForm.style.display === 'none') {
                        issueEditForm.style.display = 'block';
                        infoForm.style.display = 'none';

                        document.getElementById('editIssuTtlVal').value = response.issueInfo.issuTtl;
                        editorEditing.setHTML(response.issueInfo.issuCntn);
                        if (response.issueInfo.issuKnd == '0L1') {
                            kndVal.className = 'badge badge-danger';
                            kndVal.innerHTML = '버그';
                        } else if (response.issueInfo.issuKnd == '0L2') {
                            kndVal.className = 'badge badge-warning';
                            kndVal.innerHTML = '개선사항';
                        } else if (response.issueInfo.issuKnd == '0L3') {
                            kndVal.className = 'badge badge-info';
                            kndVal.innerHTML = '새기능';
                        } else if (response.issueInfo.issuKnd == '0L4') {
                            kndVal.className = 'badge badge-light';
                            kndVal.innerHTML = '업무';
                        }

                        if (response.issueInfo.issuSt == '0E1') {
                            stVal.className = 'badge badge-pill badge-success';
                            stVal.innerHTML = '해결';
                        } else if (response.issueInfo.issuSt == '0E2') {
                            stVal.className = 'badge badge-pill badge-dark';
                            stVal.innerHTML = '미해결';
                        } else if (response.issueInfo.issuSt == '0E3') {
                            stVal.className = 'badge badge-pill badge-secondary';
                            stVal.innerHTML = '해결불가';
                        }

                        if (response.issueInfo.issuRank == '0G1') {
                            rankVal.className = 'badge badge-primary';
                            rankVal.innerHTML = '매우높음';
                        } else if (response.issueInfo.issuRank == '0G2') {
                            rankVal.className = 'badge badge-secondary';
                            rankVal.innerHTML = '높음';
                        } else if (response.issueInfo.issuRank == '0G3') {
                            rankVal.className = 'badge badge-success';
                            rankVal.innerHTML = '보통';
                        } else if (response.issueInfo.issuRank == '0G4') {
                            rankVal.className = 'badge badge-warning';
                            rankVal.innerHTML = '낮음';
                        } else if (response.issueInfo.issuRank == '0G5') {
                            rankVal.className = 'badge badge-danger';
                            rankVal.innerHTML = '매우낮음';
                        }

                        checkEditInput();
                        findAllFile();
                    } else {
                        issueEditForm.style.display = 'none';
                        infoForm.style.display = 'block';
                    }
                })

                .fail(function (err) {
                    console.log(err)
                })
        }

        // "수정" 버튼 활성화 or 비활성화 (제목, 종류, 중요도) 3개의 값이 다 들어오는 경우 활성화 된다.
        function checkEditInput() {
            var issuTtlVal = $('#editIssuTtlVal').val();

            if (issuTtlVal == '') {
                $('.completeEditing').removeClass('registrable');
            } else {
                $('.completeEditing').addClass('registrable');
            }
        }

        $('#editIssuTtlVal').on('change', function () {
            checkEditInput();
        });

        // ajax 이슈 수정
        function updateIssue() {
            var issuNo = $('.modalIssueName').data('issuNo');
            var title = $('#editIssuTtlVal').val();
            var content = editorEditing.getHTML();
            var kind = $('#editIssuKndVal').text();
            var rank = $('#editIssuRankVal').text();
            var status = $('#editIssuStVal').text();

            // 중요도 text 값 확인 후 data로 넣기 !
            if (rank == '매우높음') {
                rank = '0G1';
            } else if (rank == '높음') {
                rank = '0G2';
            } else if (rank == '보통') {
                rank = '0G3';
            } else if (rank == '낮음') {
                rank = '0G4';
            } else if (rank == '매우낮음') {
                rank = '0G5';
            }
            // 종류 text 값 확인 후 data로 넣기 !
            if (kind == '버그') {
                kind = '0L1';
            } else if (kind == '개선사항') {
                kind = '0L2';
            } else if (kind == '새기능') {
                kind = '0L3';
            } else if (kind == '업무') {
                kind = '0L4';
            }

            // 상태 text 값 확인 후 data로 넣기 !
            if (status == '해결') {
                status = '0E1';
            } else if (status == '미해결') {
                status = '0E2';
            } else if (status == '해결불가') {
                status = '0E3';
            }

            const params = {
                issuNo: issuNo,
                issuTtl: title,
                issuCntn: content,
                issuKnd: kind,
                issuRank: rank,
                issuSt: status
            }

            $.ajax({
                url: '/ModalIssueUpdate',
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify(params)
            })
                .done(function (response) {
                    alert('수정되었습니다');
                    $('.modalIssueEditForm').css('display', 'none');
                    $('.modalIssueInfoForm').css('display', 'block');
                    viewIssueInfo(response.issuNo);
                })
                .fail(function (err) {
                    console.log(err)
                })
        }

        // 이슈 수정하기 취소 버튼
        $('.modalIssueEditForm').on('click', '.cancelEditing', function () {
            $('#cancelEditConfirmationModal').modal('show');

            // ' 확인' 버튼이 클릭 시
            $('#confirmEditCancel').on('click', function () {
                // 입력 필드 초기화

                $('#issuTtlVal').val('');
                editorEditing.setHTML('');

                $('#cancelEditConfirmationModal').modal('hide');
                $('.modalIssueEditForm').css('display', 'none');
                $('.workModalContentBack').css('display', 'block');
                issuePaging(1);
            });

            // '취소' 버튼 클릭 시
            $('#cancelCancel').on('click', function () {
                $('#cancelEditConfirmationModal').modal('hide');
            });
        });

        $('.completeEditing').on('click', function () {
            // "수정" 버튼이 활성화 상태일 때만 실행됨
            if ($(this).hasClass('registrable')) {
                updateIssue();
            } else {
                $('#editCheckingInput').modal('show');
                $('#editCheckingInput').css('display', 'block');
                // 확인 버튼 클릭 시
                $('#confirmEditCheckingInput').on('click', function () {
                    $('#editCheckingInput').modal('hide');
                    $('#editCheckingInput').css('display', 'none');
                });
            }

        });

        // 이슈 삭제
        function deleteIssue() {
            var issuNo = $('.modalIssueName').data('issuNo');
            // 경고창
            $('#delConfirmationModal').modal('show');

            $('#delCancel').on('click', function () {
                $('#delConfirmationModal').modal('hide');
            })

            $('#delConfirm').on('click', function () {
                $('#delConfirmationModal').modal('hide');
                $.ajax({
                    url: '/ModalIssueDelete',
                    type: 'post',
                    data: { issuNo: issuNo } // 데이터를 객체 형식으로 전달
                })
                    .done(function (response) {
                        $('.modalIssueInfoForm').css('display', 'none');
                        $('.workModalContentBack').css('display', 'block');
                        issuePaging(1);
                    })
                    .fail(function (err) {
                        console.log(err)
                    })
            })
        }

        // 이슈 수정 창에서 파일 리스트 조회
        function findAllFile() {
            var issuNo = $('.modalIssueName').data('issuNo');
            $('#editIssueFileList').empty();
            $.ajax({
                url: '/issues/' + issuNo + '/files',
                type: 'get'
            })
                .done(function (response) {
                    $.each(response, function (idx, item) {

                        var trTag = $('<tr/>').data('editFileNo', response.issuFileNo);

                        var fileNameTag = $('<td/>').text(item.issuFileNm);
                        var fileSizeTag = $('<td/>').text(getByteSize(item.issuFileSize));
                        var deleteFileTag = $('<td/>').attr('class', 'deleteEditFile').attr('onclick', ''); // 기존꺼 삭제하는 함수.

                        trTag.append(fileNameTag);
                        trTag.append(fileSizeTag);
                        trTag.append(deleteFileTag);

                        $('#editIssueFileList').append(trTag);
                    })
                })
                .fail(function (err) {
                    console.log(err);
                })
        }


        // 수정 폼에서 파일 추가
        const editRealUpload = document.querySelector('.editReal-upload');
        const editUpload = document.querySelector('.editingLoadBtn.upload');
        editUpload.addEventListener('click', () => editRealUpload.click());

        function addIssueFileE(element) {
            const file = element.files[0];

            // 1. 파일 선택 창에서 취소 버튼이 클릭 되는 경우
            if (!file) {
                return false;
            }
            // 2. 파일 크기가 10MB을 초과하는 경우
            const editFileSize = Math.floor(file.size / 1024 / 1024);
            if (editFileSize > 10) {
                alert('10MB 이하의 파일로 업로드해 주세요.');
                return false;
            }

            if (file) {
                var trTag = $('<tr/>').addClass('added');
                var fileNameTag = $('<td/>').text(file.name);
                var fileSizeTag = $('<td/>').text(getByteSize(file.size));
                var deleteFileTag = $('<td/>').attr('class', 'deleteEditFile').attr('onclick', 'editRemoveFile(this);');

                trTag.append(fileNameTag);
                trTag.append(fileSizeTag);
                trTag.append(deleteFileTag);

                $('#editIssueFileList').append(trTag);
            }
        }

        const editDataTransfer = new DataTransfer();

        $("#editFiles").change(function () {
            let fileArr = document.getElementById("editFiles").files

            if (fileArr != null && fileArr.length > 0) {
                // DataTransfer 파일 관리 //
                for (var i = 0; i < fileArr.length; i++) {
                    editDataTransfer.items.add(fileArr[i])
                    console.log("dataTransfer =>", editDataTransfer.files)
                    console.log("input FIles =>", document.getElementById("editFiles").files)
                }
                document.getElementById('editFiles').files = editDataTransfer.files;
            }
        })
        // 수정 폼에서 새롭게 추가된 파일 삭제 시
        function removeEditFileFromDataTransfer(element) {
            var addedFiles = $(".added");
            var index = addedFiles.index($(element).parent());
            console.log(index + "입니다");
            if (index != -1) {
                editDataTransfer.items.remove(index);
                document.getElementById("editFiles").files = editDataTransfer.files;
            }
        }
        // 수정 폼에서 새롭게 추가된 파일 삭제 시
        function editRemoveFile(element) {
            removeEditFileFromDataTransfer(element);
            var tr = $(element).closest('tr');
            tr.remove();
        }
    </script>
</th:block>

</html>