<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/layout/layout}">
<th:block layout:fragment="content">
	<div class="content-body">
		<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#workModal">Launch
			workModal</button>

		<div class="modal fade" id="workModal" tabindex="-1" aria-labelledby="sidebarModalLabel" aria-hidden="true"
			style="overflow:auto;">
			<div class="modal-dialog">
				<div class="modal-content"
					style="box-shadow: 0 3px 15px 0 rgba(0, 0, 0, 0.15); width: 780px; top: calc(( 86vh - 601px)/2); height: 671px; opacity: 1; z-index: 500; overflow: auto;">
					<!-- 모달 헤더 부분 -->
					<div class="modal-header">
						<div class="ContentTitleBox">
							<div class="ContentImg" style="background-image: url(/images/tab_issue.png);"></div>
							<p class="ContentText">이슈</p>
						</div>
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"
							style="margin: 0; padding: 0;"></button>
					</div>
					<div class="modal-content-container">
						<div class="workModalTab">
							<ul>
								<li><i class="ModalTab tab_basic"></i> <span class="tooltip">기본정보</span></li>
								<li><i class="ModalTab tab_file"></i> <span class=" tooltip">자료관리</span></li>
								<li><i class="ModalTab tab_issue"></i> <span class="tooltip">이슈</span></li>
								<li><i class="ModalTab tab_log"></i> <span class="tooltip">로그</span></li>
							</ul>
						</div>
						<div class="modal-body">
							<div class="workModalContentBack">
								<div class="workModalContentSlider">
									<div class="workModalContent issueContent">
										<div class="workModalBussTitle">
											<div class="ModalTitle">
												<div class="ModalProjectNameBox">
													<div id="ProjectLink">
														#<span></span>
														<p class="textEllipsis" th:text="${issueList[0].prjtNm}" />
													</div>
												</div>
												<div class="ModalBussNameBox Edit">
													<div class="ModalBussNameBack">
														<textarea id="ModalUpdateBussName"
															th:text="${issueList[0].bussNm}" readonly maxlength="200"
															style="height: 34px;"></textarea>
													</div>
												</div>
											</div>
										</div>
										<div class="ModalInfo">
											<div class="FixOnTop ModalTopBar">
												<div class="IssueTopBar">
													<div></div>
													<div class="TobBarIssueControlArea">

														<div class="SearchBox">
															<label for="SearchToggleCheckBox"
																th:attr="onclick='issuePaging(1)'"></label> <input
																type="hidden" id="keyword" name="keyword" value="전체">
															<div class="SearchInputBox" style="width: 270px;">
																<div>
																	<div class="issue-selectBox" style="width: 100px;">
																		<div class="issue-selected" id="issue-selected">
																			<div class="issue-selected-value">전체</div>
																			<div class="arrow"></div>
																		</div>
																		<ul class="issue-select-ul"
																			style="width: 100px; top: 20%; display: none;">
																			<li class="issue-select-option"
																				data-value="전체">전체</li>
																			<li class="issue-select-option"
																				data-value="작성자">작성자</li>
																			<li class="issue-select-option"
																				data-value="제목">제목</li>
																		</ul>
																	</div>
																</div>
																<input class="SearchInputModalView" id="search"
																	name="search" type="text"
																	placeholder="검색어를 입력하세요."><span
																	class="DeleteSearchWord"></span>
															</div>
														</div>

														<button class="postWritingBox">
															<span></span>
															<p>글쓰기</p>
														</button>

													</div>
												</div>
											</div>
											<div class="ModalInfoArea IssueInfoArea">

												<div class="col-lg-6" style="width: 100%; max-width: 100%;">

													<div class="table-responsive">
														<table class="table table-hover">
															<thead>
																<tr>
																	<th style="font-weight: normal;">종류</th>
																	<th style="font-weight: normal;">제목</th>
																	<th style="font-weight: normal;">이름</th>
																	<th style="font-weight: normal;">상태</th>
																	<th style="font-weight: normal;">우선순위</th>
																</tr>
															</thead>
															<tbody id="issueLists">
																<th:block th:each="issueList : ${issueList}">
																	<tr th:data-value="${issueList.issuNo}">
																		<th th:if="${issueList.issuKnd == '0L1'}"><span
																				class="badge badge-danger"
																				th:text="버그"></span></th>
																		<th th:if="${issueList.issuKnd == '0L2'}"><span
																				class="badge badge-warning"
																				th:text="개선사항"></span></th>
																		<th th:if="${issueList.issuKnd == '0L3'}"><span
																				class="badge badge-info"
																				th:text="새기능"></span></th>
																		<th th:if="${issueList.issuKnd == '0L4'}"><span
																				class="badge badge-light"
																				th:text="업무"></span></th>
																		<td th:text="${issueList.issuCntn}"></td>
																		<td th:text="${issueList.membId}"></td>
																		<th th:if="${issueList.issuSt == '0E1'}"><span
																				class="badge badge-pill badge-success"
																				th:text="해결"></span></th>
																		<th th:if="${issueList.issuSt == '0E2'}"><span
																				class="badge badge-pill badge-dark"
																				th:text="미해결"></span>
																		</th>
																		<th th:if="${issueList.issuSt == '0E3'}">
																			<span
																				class="badge badge-pill badge-secondary"
																				th:text="해결불가"></span>
																		</th>

																		<th th:if="${issueList.issuRank == '0G1'}"><span
																				class="badge badge-primary"
																				th:text="매우높음"></span></th>
																		<th th:if="${issueList.issuRank == '0G2'}"><span
																				class="badge badge-secondary"
																				th:text="높음"></span></th>
																		<th th:if="${issueList.issuRank == '0G3'}"><span
																				class="badge badge-success"
																				th:text="보통"></span></th>
																		<th th:if="${issueList.issuRank == '0G4'}"><span
																				class="badge badge-warning"
																				th:text="낮음"></span></th>
																		<th th:if="${issueList.issuRank == '0G5'}"><span
																				class="badge badge-danger"
																				th:text="매우낮음"></span></th>
																	</tr>
																</th:block>
															</tbody>
														</table>
													</div>
												</div>
											</div>

										</div>
										<div class="paginate-container d-none d-sm-flex flex-sm-justify-center">
											<div role="navigation" aria-label="Pagination" class="pagination">

												<a id="previous_page"
													th:classappend="${issue.prePage == 0} ? 'disabled'"
													th:attr="onclick='issuePaging(\'' + ${issue.prePage} + '\')'">Previous</a>
												<a class="cur_page"
													th:each="page: ${#numbers.sequence(issue.navigateFirstPage, issue.navigateLastPage)}"
													th:text="${page}"
													th:attr="onclick='issuePaging(\'' + ${page} + '\')'"></a>
												<a id="next_page" th:classappend="${issue.nextPage == 0} ? 'disabled'"
													th:attr="onclick='issuePaging(\'' + ${issue.nextPage} + '\')'">Next</a>
											</div>
										</div>
									</div>
								</div>
							</div>
							<!-- @@@@@@@@@@@@@@@@@@@@@@@@여기서 부터 이슈 등록 폼@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->
							<div class="modalIssueInsertForm" style="display: none">

								<div class="modalInsertContent">
									<div class="issueInsertContentTopBar">
										<span class="cancelWriting"></span>
										<button type="button" class="completeWriting">등록</button>
									</div>
								</div>
								<div class="issueNameEdit">
									<div class="issueNameBack">
										<textarea class="modalIssueNameUpdate" id="issuTtlVal" maxlength="200"
											style="height: 34px;" placeholder="제목을 입력하세요."></textarea>
									</div>
								</div>
								<hr style="margin: 0; height: 2px; background-color: #eaeaea; width: 608px;">
								<!--  이슈 종류, 이슈 중요도-->
								<div class="issueKnd">
									<p>종류</p>
									<div class="dropBoxArea">
										<div class="basic-dropdown" style="display: inline;">
											<div class="dropdown">
												<button type="button" id="issuKndVal" name="issuKndVal"
													class="badge badge-dark" data-toggle="dropdown">선택</button>
												<div class="dropdown-menu">
													<a class="dropdown-item"><span
															class="badge badge-pill badge-warning">개선사항</span></a>
													<a class="dropdown-item"><span
															class="badge badge-pill badge-info">새기능</span></a> <a
														class="dropdown-item"><span
															class="badge badge-pill badge-light">업무</span></a>
													<a class="dropdown-item"><span
															class="badge badge-pill badge-danger">버그</span></a>
												</div>
											</div>
										</div>
									</div>

									<div class="issueRank">
										<p>중요도</p>
										<div class="dropBoxArea">
											<div class="basic-dropdown">
												<div class="dropdown">
													<button type="button" class="badge badge-dark"
														data-toggle="dropdown" id="issuRankVal">선택</button>
													<div class="dropdown-menu" style="cursor: pointer;">
														<a class="dropdown-item"><span
																class="badge badge-primary">매우높음</span></a> <a
															class="dropdown-item"><span
																class="badge badge-secondary">높음</span></a> <a
															class="dropdown-item"><span
																class="badge badge-success">보통</span></a> <a
															class="dropdown-item"><span
																class="badge badge-warning">낮음</span></a> <a
															class="dropdown-item"><span
																class="badge badge-danger">매우낮음</span></a>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="writingContent">
									<div class="writingSection">
										<div class="sectionTitle">
											<p class="sectionTitleText" id="issuCntnVal">내용</p>
										</div>

										<div id="editor" style="width: 630px;"></div>

									</div>

									<div class="attachSection">
										<div class="sectionTitle">
											<p class="sectionTitleText">파일</p>
											<div class="LoadBtn upload">
												<span></span>
												<p>파일 업로드</p>
												<input type="file" class="real-upload" id="files" name="files" multiple
													onchange="addIssueFile(this);" style="display: none;">
											</div>
										</div>
										<div class="fileupload dz">
											<div class="dz-message" style="width: 630px;">
												<table class="table">
													<thead>
														<tr>
															<th>파일명</th>
															<th>크기</th>
															<th></th>
														</tr>
													</thead>
													<tbody id="issueFileList">
													</tbody>
												</table>
											</div>
										</div>
									</div>
									<div class="hashtagSection">
										<div class="sectionTitle">
											<p class="sectionTitleText">해시태그</p>
										</div>
										<div class="hashtagContent" style="width: 630px;">
											<div class="hashtagList">
												<div class="tagBox task" title="업무">
													<p>#</p>
													<span class="Ready"></span>
													<p class="textEllipsis">업무</p>
												</div>
											</div>
										</div>
									</div>
								</div>
								<!--  취소 확인하는 모달  -->
								<div class="modal fade" id="cancelConfirmationModal" tabindex="-1"
									style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header" style="border-bottom: none;">
												<button type="button" class="close" data-dismiss="modal"
													style="margin: 0; padding: 0;" aria-label="Close"></button>
											</div>
											<div class="modal-body" id="cancelConfirmationModalBody">
												<img class="cancelWarning"> <span id="modal-meg" class="notice_msg">현재
													작성중인
													글은 저장되지 않습니다.<br> 뒤로
													가시겠습니까?
												</span>
											</div>
											<div class="modal-footer" style="border-top: none;">
												<button type="button" class="btn btn-danger btn-sm"
													id="cancelCancel">취소</button>
												<button type="button" class="btn btn-light btn-sm"
													id="confirmCancel">확인</button>
											</div>
										</div>
									</div>
								</div>
								<!--  취소 확인 하는 모달 END -->

								<!-- 종류, 제목, 중요도가 다 입력되지 않았을 때  -->
								<div class="modal fade" id="checkingInput" tabindex="-1"
									style="display: none; margin-top: 200px; margin-left: 200px;" aria-hidden="true">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header" style="border-bottom: none;">
												<button type="button" class="close" data-dismiss="modal"
													style="margin: 0; padding: 0;" aria-label="Close"></button>
											</div>
											<div class="modal-body" id="cancelConfirmationModalBody">
												<img class="cancelWarning"> <span id="modal-meg" class="notice_msg">제목,
													종류, 중요도를 입력하세요!<br>
												</span>
											</div>
											<div class="modal-footer" style="border-top: none;">
												<button type="button" class="btn btn-info btn-sm"
													id="confirmCheckingInput" style="margin: auto;">확인</button>
											</div>
										</div>
									</div>
								</div>
								<!-- END -->
							</div>
							<!-- @@@@@@@@@@@@@@@@@@@@@@@@이슈 등록폼 END@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ -->

							<!-- 이슈 상세보기 조회 시작!!!!! -->
							<div class="modalIssueInfoForm" style="display: none;">
								<div class="modalIssueInfoContent">
									<div class="issueInfoContentTopBar">
										<span class="returnIssueList" onclick="returnIssueList()"></span>
									</div>

									<div class="issueNameInfo">
										<div class="issueNames">
											<textarea class="modalIssueName" maxlength="200" style="height
											: 34px;"
												readonly></textarea>
										</div>
									</div>
									<hr style="margin: 0; height: 2px; background-color: #eaeaea; width: 608px;">
									<div class="read-content">
										<div class="media pt-5">
											<img class="mr-3 rounded-circle" src="images/avatar/1.jpg">
											<div class="media-body" style="margin-right: 50px; flex: 0;">
												<h5 class="m-b-3"></h5>
												<p class="m-b-2" style="width: 75px;">2023/10/24</p>

											</div>
											<div class="issueRankInfo">
												<p>중요도</p>
											</div>
											<div class="issueKndInfo">
												<p>종류</p>
											</div>
											<div class="issueStInfo">
												<p>상태</p>
											</div>
										</div>
										<hr style="margin:0 ; height: 1px; background-color: #eaeaea; width: 608px;">
										<div class="card-body">
											<div id="viewer"></div>
										</div>
										<h6 class="p-t-15" style="display: inline-block; padding: 3px; "><i
												class="fa fa-download mb-2"></i> 첨부파일 <span id="countFile"></span></h6>
										<h6 class="p-t-16"
											style="display: inline-block; margin-left: 20px; padding: 3px; "><i
												class="fa fa-comment mb-2" style="margin-right: 5px;"></i>댓글 <span
												id="countReply"></span></h6>
										<hr style="margin: 0; height: 1px; background-color: #eaeaea; width: 608px;">

										<div class="issueInfoFileList" style="display: none;">
											<div class="list-message" style="width: 630px;">
												<table class="table">
													<thead>
														<tr>
															<th>파일명</th>
															<th>크기</th>
															<th></th>
														</tr>
													</thead>
													<tbody id="issueInfoFiles">
														<tr class="InfoFilesEmpty">
															<td style="color: rgb(168, 168, 168);">등록된 파일이 없습니다.</td>
															<td></td>
															<td></td>
														</tr>
													</tbody>
												</table>
											</div>
										</div>
										<div class="issueInfoCommentList" style="display: none;">
											<div class="IssueReviews">

											</div>
											<!-- 이슈 댓글 작성 -->
											<div class="issueReply__details__form">
												<div class="issueReply__section-title">
													<h5>댓글<i id="counter">0/300자</i></h5>
												</div>
												<form action="#">
													<textarea id="issueReplyCntn" name="issueReplyCntn"
														onkeyup="countingLength(this);"
														placeholder="댓글을 입력하세요"></textarea>

													<button type="button" id="issueReplySave" onclick="saveReply();"><i
															class="fa fa-location-arrow"></i>등록</button>
												</form>
											</div>

										</div>
									</div>
								</div>
							</div>
							<!-- 이슈 상세보기 END!!!!! -->
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script th:inline="javascript">

		// 날짜 변환
		function dateFormatting(date) {

			let parseDate = new Date(date);

			let year = parseDate.getFullYear();
			let month = ('0' + (parseDate.getMonth() + 1)).slice(-2);
			let day = ('0' + parseDate.getDate()).slice(-2);
			return year + '-' + month + '-' + day;
		}

		// 글상세보기에서 글목록으로 돌아가기 버튼
		function returnIssueList() {
			// 입력 필드 초기화
			$('#issuReplyCntn').val('');
			$('#updateReplyComment').val('');
			$('.modalIssueInfoForm').css('display', 'none');
			$('.workModalContentBack').css('display', 'block');
			issuePaging(1);
		}
								
		$(document).on('click', '#issueLists tr', function () {
			var issuNo = $(this).data('value');
			$.ajax('/ModalIssueInfo?issuNo=' + issuNo)
				.done(function (data) {
					var issueInfo = data.issueInfo;
					var issueFile = data.issueFile;

					$('.modalIssueName').val(issueInfo.issuTtl).data('issuNo', issuNo);
					$('.m-b-3').text(issueInfo.membId);

					$('.m-b-2').text(dateFormatting(issueInfo.issuDt));
					viewer.setMarkdown(issueInfo.issuCntn);
					countReply(issuNo);
					countFile(issuNo);
					// 종류 
					var kndVal = $('.issueKndInfo');
					if (issueInfo.issuKnd == '0L1') {
						kndVal.append('<div class="badge badge-danger" style="margin-bottom: 15px; ">버그</div>');
					} else if (issueInfo.issuKnd == '0L2') {
						kndVal.append('<div class="badge badge-warning" style="margin-bottom: 15px; ">개선사항</div>');
					} else if (issueInfo.issuKnd == '0L3') {
						kndVal.append('<div class="badge badge-info" style="margin-bottom: 15px; ">새기능</div>');
					} else if (issueInfo.issuKnd == '0L4') {
						kndVal.append('<div class="badge badge-light" style="margin-bottom: 15px; ">업무</div>');
					}
					// 상태
					if (issueInfo.issuSt == '0E1') {
						$('.issueStInfo').append('<div class="badge badge-pill badge-success" style="margin-bottom: 15px; ">해결</div>');
					} else if (issueInfo.issuSt == '0E2') {
						$('.issueStInfo').append('<div class="badge badge-pill badge-dark" style="margin-bottom: 15px; ">미해결</div>');
					} else if (issueInfo.issuSt == '0E3') {
						$('.issueStInfo').append('<div class="badge badge-pill badge-secondary" style="margin-bottom: 15px; ">해결불가</div>');
					}

					if (issueInfo.issuRank == '0G1') {
						$('.issueRankInfo').append('<div class="badge badge-pill badge-primary" style="margin-bottom: 15px; ">매우높음</div>');
					} else if (issueInfo.issuRank == '0G2') {
						$('.issueRankInfo').append('<div class="badge badge-pill badge-secondary" style="margin-bottom: 15px; ">높음</div>');
					} else if (issueInfo.issuRank == '0G3') {
						$('.issueRankInfo').append('<div class="badge badge-pill badge-success" style="margin-bottom: 15px; ">보통</div>');
					} else if (issueInfo.issuRank == '0G4') {
						$('.issueRankInfo').append('<div class="badge badge-pill badge-warning" style="margin-bottom: 15px; ">낮음</div>');
					} else if (issueInfo.issuRank == '0G5') {
						$('.issueRankInfo').append('<div class="badge badge-pill badge-danger" style="margin-bottom: 15px; ">매우낮음</div>');
					}

					// 첨부된 파일 리스트.												
					$.each(issueFile, function (idx, item) {

						if (issueFile != null) {
							$('#issueInfoFiles').empty();
						}

						var trTag = $('<tr/>').data('fileNo', issueFile.issuFileNo);

						var fileNameTag = $('<td/>').text(item.issuFileNm);
						var fileSizeTag = $('<td/>').text(getByteSize(item.issuFileSize));
						var downloadFileTag = $('<td/>').attr('class', 'downloadFile').attr("onclick", "fileDownloading(" + issuNo + "," + item.issuFileNo + ")");
						trTag.append(fileNameTag);
						trTag.append(fileSizeTag);
						trTag.append(downloadFileTag);

						$('#issueInfoFiles').append(trTag);
					});
					countFile(issuNo);
				})
				.fail(function (error) {
					console.log(error);
				})

			$('.modalIssueInfoForm').css('display', 'block');
			$('.workModalContentBack').css('display', 'none');
		});

		function fileDownloading(issuNo, issuFileNo) {
			location.href = '/issues/' + issuNo + '/files/' + issuFileNo + '/download';
		}


		$(document).on('click', '.p-t-15', function () {
			if ($('.issueInfoFileList').css("display") == "none") {
				$('.issueInfoFileList').css('display', 'block');
			} else {
				$('.issueInfoFileList').css('display', 'none');
			}

			$('.issueInfoCommentList').css('display', 'none');
		});

		$(document).on('click', '.p-t-16', function () {
			if ($('.issueInfoCommentList').css("display") == "none") {
				$('.issueInfoCommentList').css('display', 'block');
				findAllReply();
			} else {
				$('.issueInfoCommentList').css('display', 'none');
			}

			$('.issueInfoFileList').css('display', 'none');
		});

		// 댓글 길이 카운팅
		function countingLength(content) {
			if (content.value.length > 300) {
				alert('댓글을 300자 이하로 입력해 주세요.');
				content.value = content.value.substring(0, 300);
				content.focus();
			}
			document.getElementById('counter').innerText = content.value.length + '/300자';
		}

		// 댓글 저장
		function saveReply() {
			const issueReplyCntn = document.getElementById('issueReplyCntn');
			const issuNo = $('.modalIssueName').data('issuNo');

			const params = {
				issuNo: issuNo,
				issuRplyCntn: issueReplyCntn.value,
				membId: 'ojunkwon'
			}

			$.ajax({
				url: '/issues/' + issuNo + '/reply',
				type: 'post',
				contentType: 'application/json;',
				data: JSON.stringify(params)
			})
				.done(function (data) {
					findAllReply();
					countReply(issuNo);
				})
				.fail(function (error) {
					console.log(error);
				})
		}

		// 전체 댓글 조회
		function findAllReply() {
			const issuNo = $('.modalIssueName').data('issuNo');

			$.ajax({
				url: '/issues/' + issuNo + '/reply',
				type: 'GET'
			})
				.done(function (response) {

					// 1. 조회된 데이터가 없는 경우
					if (!response.length) {
						document.querySelector('.IssueReviews').innerHTML = '<div class="cm_none"><p>등록된 댓글이 없습니다.</p></div>';
						return false;
					}

					// 2. 렌더링 할 HTML을 저장할 변수
					let commentHtml = '';

					// 3. 댓글 HTML 추가
					response.forEach(row => {
						commentHtml += `                            
                            <div class="IssueReviews">
							<div class="issue__reply__item">
								<div class="issue__reply__item__pic">
									<img src="images/users/2.jpg" alt="">
								</div>
								<div class="issue__reply__item__text">
									<h6>${row.membId} - <span>${dateFormatting(row.issuRplyDt)}</span>
									<a id="edit_btn" onclick="openReplyUpdateForm(${row.issuRplyNo})"> <img class="toolsIcon"
										src="https://community.akamai.steamstatic.com/public/images//sharedfiles/icons/icon_edit.png" 
										style="margin-left: 170px; ">
										수정
									</a>
									<a id="del_btn" onclick="deleteReply(${row.issuRplyNo});"> <img class="toolsIcon"
										src="https://community.akamai.steamstatic.com/public/images//sharedfiles/icons/icon_delete.png">
										삭제
									</a>
									
									</h6>
									
									<div id="IssueReplyEditForm" style="display: none;">
											<textarea id="updateReplyComment" class="reply_edit_text_area" maxlength="300" rows="2"
												cols="30" placeholder="수정할 내용을 입력"></textarea>
											<button type="button" class="button condensed save" id="replyUpdateBtn">저장</button>
											<button type="button" class="button condensed cancel"
												onclick="closeReplyUpdateForm();">취소</button>
									</div>
									
									
									<p id="replyText">${row.issuRplyCntn}</p>
								</div>
							</div>
                        `;

						// 4. class가 "IssueReviews"인 요소를 찾아 HTML을 렌더링
						document.querySelector('.IssueReviews').innerHTML = commentHtml;

					})
					countReply(issuNo);
				})
				.fail(function (err) {
					console.log(err)
				})
		}

		// 댓글 수정 div open
		function openReplyUpdateForm(id) {

			const issuNo = $('.modalIssueName').data('issuNo');
			const issuRplyNo = id;
			$.ajax({
				url: '/issues/' + issuNo + '/reply/' + issuRplyNo,
				type: 'get'
			})
				.done(function (response) {
					var editForm = document.getElementById('IssueReplyEditForm');
					var replyText = document.getElementById('replyText');

					if (editForm.style.display === 'none') {
						editForm.style.display = 'block';
						replyText.style.display = 'none';

						document.getElementById('updateReplyComment').value = response.issuRplyCntn;
						document.getElementById('replyUpdateBtn').setAttribute('onclick', `updateReply(${id})`);
					} else {
						editForm.style.display = 'none';
						replyText.style.display = 'block';
					}
				})

				.fail(function (err) {
					console.log(err)
				})

		}

		// 댓글 수정 div close
		function closeReplyUpdateForm() {
			document.getElementById('updateReplyComment').value = '';
			document.getElementById('replyUpdateBtn').removeAttribute('onclick');

			document.getElementById('IssueReplyEditForm').style.display = 'none';
			document.getElementById('replyText').style.display = 'block';
		}

		// 댓글 수정 ajax
		function updateReply(id) {
			const issuNo = $('.modalIssueName').data('issuNo');
			const issuRplyNo = id;
			const writer = 'ojunkwon';
			const content = document.getElementById('updateReplyComment');

			const params = {
				issuRplyNo: id,
				issuNo: issuNo,
				issuRplyCntn: content.value,
				membId: writer
			}

			$.ajax({
				url: '/issues/' + issuNo + '/reply/' + issuRplyNo,
				type: 'put',
				contentType: 'application/json;',
				data: JSON.stringify(params)
			})
				.done(function (response) {
					alert('수정되었습니다.');
					findAllReply();
					closeReplyUpdateForm();
					countReply(issuNo);
				})

				.fail(function (err) {
					console.log(err)
				})
		}

		// 댓글 삭제
		function deleteReply(id) {

			if (confirm('선택하신 댓글을 삭제할까요?')) {

				const issuNo = $('.modalIssueName').data('issuNo');
				const issuRplyNo = id;

				$.ajax({
					url: '/issues/' + issuNo + '/reply/' + issuRplyNo,
					type: 'delete'
				})
					.done(function (response) {
						alert('삭제가 완료되었습니다');
						findAllReply();
						countReply(issuNo);
					})

					.fail(function (err) {
						console.log(err)
					})
			}
		}

		// 댓글 카운트
		function countReply(issuNo) {
			$.ajax({
				url: '/issues/' + issuNo + '/reply/count',
				type: 'get'
			})
				.done(function (response) {
					$('#countReply').text('(' + response + ')');
				})
				.fail(function (err) {
					console.log(err)
				})
		}

		// 파일 카운트
		function countFile(issuNo) {
			$.ajax({
				url: '/issues/' + issuNo + '/files/count',
				type: 'get'
			})
				.done(function (response) {
					$('#countFile').text('(' + response + ')');
				})
				.fail(function (err) {
					console.log(err)
				})
		}
	</script>
</th:block>

</html>