<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>마스터 관리</title>
<!-- 전체 css -->
<link href="/css/style.css" rel="stylesheet">
<!-- dataTables -->
<!-- <link href="/plugins/tables/css/datatable/dataTables.bootstrap4.min.css" rel="stylesheet"> -->
<!--  jquery -->
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<!-- 전체 js -->
<script src="plugins/common/common.min.js"></script>
<script src="js/custom.min.js"></script>
<script src="js/settings.js"></script>
<script src="js/gleek.js"></script>
<script src="js/styleSwitcher.js"></script>
<!-- dataTables -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.css" />
  
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.js"></script>
<!-- <script src="/plugins/tables/js/jquery.dataTables.min.js"></script> -->
<!-- <script src="/plugins/tables/js/datatable/dataTables.bootstrap4.min.js"></script>
<script src="/plugins/tables/js/datatable-init/datatable-basic.min.js"></script> -->
</head>
<body>
	<div id="main-wrapper">
		<header th:replace="fragments/header :: header"></header>
		
		<div class="content-body">
			<h1>마스터 관리</h1>
			<hr>
			<button type="button" class="btn mx-2 btn-outline-secondary">회사</button>
			<button type="button" class="btn mx-2 btn-outline-secondary">회원</button>
			<hr>
			<div class="card">
				<div class="card-body">
					<div class="table-responsive">
						<table class="table table-striped table-bordered companyTable">
							<thead>
								<tr>
									<th>회사코드</th>
									<th>상호명</th>
									<th>대표자명</th>
									<th>사업자 등록번호</th>
									<th>법인 설립일</th>
									<th>가입</th>
									<th>승인</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="c : ${masterCompanyList}">
									<td th:text="${c.coCd}"></td>
									<td th:text="${c.coNm}"></td>
									<td th:text="${c.coRpstr}"></td>
									<td th:text="${c.coBizno}"></td>
									<td th:text="${#dates.format(c.coDt, 'yyyy-MM-dd')}"></td>
									<td th:text="${c.coAccp}"></td>
									<td>
										<button th:if="${c.coAccp == '대기'}"
											type="button" class="btn mx-2 px-2 py-0 btn-success">
											<i class="fa fa-check"></i>
										</button>
										<button th:if="${c.coAccp == '승인'}"
											type="button" class="btn mx-2 px-2 py-0 btn-danger">
											<i class="fa fa-close"></i>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					<div class="table-responsive" style="display:none">
						<table class="table table-striped table-bordered memberTable">
							<thead>
								<tr>
									<th>회사코드</th>
									<th>회사</th>
									<th>아이디</th>
									<th>이름</th>
									<th>생년월일</th>
									<th>이메일</th>
									<th>전화번호</th>
									<th>가입</th>
									<th>승인</th>
								</tr>
							</thead>
							<tbody>
								<tr th:each="m : ${masterMemberList}">
									<td th:text="${m.coCd}"></td>
									<td th:text="${m.coNm}"></td>
									<td th:text="${m.membId}"></td>
									<td th:text="${m.membNm}"></td>
									<td th:text="${#dates.format(m.membBirthDt, 'yyyy-MM-dd')}"></td>
									<td th:text="${m.membEmail}"></td>
									<td th:text="${m.membTelno}"></td>
									<td th:text="${m.membAccp}">
										
									</td>
									<td>
										<button th:if="${m.membAccp == '대기'}"
											type="button" class="btn mx-2 px-2 py-0 btn-success">
											<i class="fa fa-check"></i>
										</button>
										<button th:if="${m.membAccp == '승인'}"
											type="button" class="btn mx-2 px-2 py-0 btn-danger">
											<i class="fa fa-close"></i>
										</button>
									</td>
								</tr>
							</tbody>
						</table>
					</div>
				</div>
			</div>
		</div>
	</div>
	<script th:inline="javascript">
		var companyList = [[${masterCompanyList}]];
		var memberList = [[${masterMemberList}]];
		
		// dataTable 선언
		var companyTable = $('.companyTable').DataTable();
		var memberTable = $('.memberTable').DataTable();
		companyTable
					.order([5, 'asc']
						 , [0, 'desc'])
					.draw();
		memberTable
					.order([7, 'asc']
						 , [0, 'desc'])
					.draw();

	
		// 회사 버튼 클릭 시
		$('button').eq(0).on('click', function(){
			$('.table-responsive').eq(0).css('display', 'block');
			$('.table-responsive').eq(1).css('display', 'none');
		});
		// 회원 버튼 클릭 시
		$('button').eq(1).on('click', function(){
			$('.table-responsive').eq(0).css('display', 'none');
			$('.table-responsive').eq(1).css('display', 'block');
		});
		
		// 회사 승인 ajax
		$('tbody').eq(0).find('button').on('click', function(event){
			var obj = new Object();
			var findTd = $(this).closest('tr').find('td');
			obj.coCd = findTd.eq(0).text();
			obj.coAccp = findTd.eq(5).text();
			
			$.ajax({
				type: 'post',
				url: 'updateCompanyAccp',
				contentType: 'application/json',
				data: JSON.stringify(obj),
				success: function(){
					
				},
				error: function(error){
					console.log(error);
				}
			})
		});
		
		// 멤버 승인 ajax
		$('tbody').eq(1).find('button').on('click', function(event){
			var obj = new Object();
			var findTd = $(this).closest('tr').find('td');
			obj.coCd = findTd.eq(0).text();
			obj.coAccp = findTd.eq(7).text();
			
			$.ajax({
				type: 'post',
				url: 'updateCompanyAccp',
				contentType: 'application/json',
				data: JSON.stringify(obj),
				success: function(){
					
				},
				error: function(error){
					console.log(error);
				}
			})
		});
		
	</script>

	
</body>
</html>