<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>프로젝트 캘린더</title>
<link href="/css/style.css" rel="stylesheet">
<script src='https://cdn.jsdelivr.net/npm/fullcalendar-scheduler@6.1.9/index.global.min.js'></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

<style type="text/css">
#projectCalendarBox {
	width: 70%;
	
	float: right;
}

#projectCalendar {
	margin: 10px;
	background-color: white;
}

.calendarBusinessInfo {
	height: 700px;
	width: 30%;
	padding: 10px;
	background-color: #dddddd;
	float: right;
}

select {
	appearance: none;
	text-align: center;
}

.fc .fc-toolbar.fc-header-toolbar {
	margin: 10px;
}

.fc-toolbar-chunk {
    display: flex;
    align-items: center;
}

#fc-dom-1 {
	margin-left: 0;
}

.fc .fc-prev-button {
	margin-right: 0.75em;
}

.fc-event {
	padding: 0;
}

.fc-event-title-container {
	height: 1.5em;
	padding-top: 0.15em;
}

.fc-event-title.fc-sticky {
	font-size: 0.75em;
	margin-bottom: 0;
}

.selectBox {
	background-color:red;
	width: 100%;
	margin: 10px 0;
	float:left;
	
}

.businessList {
	background-color: white;
	width: 100%;
	border-radius: 5px;
	float: left;
	padding: 10px;
	margin: 0.8px;
}

.businessList2 {
	overflow: hidden;
	text-overflow: ellipsis;
	height: 18px;
	font-size: 1em;
	word-wrap : brek-word;
	display : -webkit-box;
	-webkit-line-clamp : 1;
	-webkit-box-orient: vertical;
}
</style>
</head>
<body>
	<div id="main-wrapper">
		<header th:replace="fragments/header :: header"></header>
		<aside th:replace="fragments/aside:: aside"></aside>
		
		<div class="content-body">
			
			<!-- --------------
				업무 목록 - 정렬 버튼
			--------------- -->
			<div class='calendarBusinessInfo'>
				<div class="selectBox">
					<span style="float:right;">
						<select name="projectCalendarSort" id="projectCalendarSort">
							<option hidden="" disabled="disabled" selected="selected" value="">정렬</option>
							<option value="date">날짜순</option>
							<option value="prgre">진척도</option>
							<option value="imp">중요도</option>
						</select>
					</span>
				</div>
				
				<!-- ---------------
					업무 목록 - 리스트
				----------------- -->
				<div class="businessListBox">
					<th:block th:each="bussInfo : ${projectCalendarList}">
						<div class="businessList"
							onMouseover="this.style.backgroundColor='#eeeeee';"
							onMouseout="this.style.backgroundColor='#ffffff';">
							<div class="businessList2" th:text="${#dates.format(bussInfo.bussFrdt, 'yy.MM.dd')} + ' ~ ' + ${#dates.format(bussInfo.bussTodt, 'yy.MM.dd')} + ' | 중요도 ' + ${bussInfo.bussImp}">
							</div>
							<div class="businessList2" th:text="${bussInfo.bussNm} + ' | 진척도 ' + ${bussInfo.bussPrgre} + '%'"></div>
						</div>
					</th:block>
				</div>
				
				<!-- -----------------
					업무 목록 - 페이징
				------------------ -->
				
			</div>
				
			<!-- --------------
				달력&차트 내용
			--------------- -->
			<div id="projectCalendarBox" >
				<div id='projectCalendar' class="tab-pane"></div>
				
				<div id='projectGanttchart' class="tab-pane">project gantt chart</div>
			</div>
		</div>
	</div>
	
	<script th:inline="javascript">
	    let calendarData = [[${projectCalendarList}]];
	    
	    /*----------------------------
			업무리스트 정렬
		------------------------------*/
	   	$('#projectCalendarSort').change(function(){
	   		/* 정렬 기능 */
	   		if($('#projectCalendarSort option:selected').val()=="date"){
	   			calendarData.sort(function(a, b){
	   				if(a.bussFrdt<b.bussFrdt) return -1;
	   				if(a.bussFrdt>b.bussFrdt) return 1;
	   				if(a.bussFrdt===b.bussFrdt) return 0;
	   			});
			} else if($('#projectCalendarSort option:selected').val()=="prgre"){
				calendarData.sort(function(a, b){
					if(a.bussPrgre>b.bussPrgre) return -1;
					if(a.bussPrgre<b.bussPrgre) return 1;
					if(a.bussPrgre===b.bussPrgre) return 0;
				});
			}
	   		console.log(calendarData);
	   		
	   		/* 화면 재생성 */
	   		$('.businessList').remove();
	   		
	   		for(let i=0; i<calendarData.length; i++){
	   			$('.businessListBox').append($('<div class="businessList"></div>'));
	   			$('.businessList').attr("onMouseover", "this.style.backgroundColor='#eeeeee';");
	   			$('.businessList').attr("onMouseout", "this.style.backgroundColor='#ffffff';");
	   			
	   			
	   		}
	   	});
	   	
	   	
	    
    	document.addEventListener('DOMContentLoaded', function() {
        	var calendarEl = document.getElementById('projectCalendar');
        	
        	/*----------------------------
        		Calendar 구현
        	------------------------------*/
        	var calendar = new FullCalendar.Calendar(calendarEl, {
        		initialView: 'dayGridMonth',
        		customButtons: {
        			calendarBtn: {
        				text: '달력',
        				click: function(){
        					$('#projectCalendar').css("display","flex");
        					$('#projectGanttchart').css("display","none");
        				}
        			},
        			ganttBtn: {
        				text: '차트',
        				click: function(){
        					$('#projectGanttchart').css("display","flex");
        					$('#projectCalendar').css("display","none");
        				}
        			}
        		},
        		headerToolbar: {
					left: 'today',
					center: 'prev title next',
					right: 'calendarBtn,ganttBtn'
				},
				titleFormat: function (date) {
		    	// YYYY년 MM월
		    		return `${date.date.year}년 ${date.date.month + 1}월`;
		    	},
		    	events: projectCalendarArr()
        	});
        	calendar.render();
      	});
    	
    	
    	/*----------------------------
    		Calendar - events 출력
    	------------------------------*/
    	function projectCalendarArr(){
    		let arr = [];
    		
    		for(let i=0; i<calendarData.length; i++){
    			let obj = new Object();
    			
    			obj.title = calendarData[i].bussNm;
    			obj.start = calendarData[i].bussFrdt;
    			obj.end = calendarData[i].bussTodt;
    			arr.push(obj);
    		}
    		return arr;
    	}
    </script>
	
	<script src="plugins/common/common.min.js"></script>
	<script src="js/custom.min.js"></script>
	<script src="js/settings.js"></script>
	<script src="js/gleek.js"></script>
	<script src="js/styleSwitcher.js"></script>
</body>
</html>













