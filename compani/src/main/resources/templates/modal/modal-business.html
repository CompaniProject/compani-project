
<form class="form-valide" action="#" method="post">
	<div>
		<div class="issueNameEdit">
			<div class="issueNameBack">
				<textarea class="modalIssueNameUpdate" id="bussNm" name='bussNm'
					maxlength="200" style="height: 34px;" placeholder="업무명을 입력하세요."></textarea>
			</div>
		</div>
		<div>

			<div class="card" style="height: 200px;">
				<div class="card-body" style="overflow: auto;">
					<div class="table-responsive">
						<table class="table">
							<thead>
								<tr>
									<th>프로필</th>
									<th>부서</th>
									<th>직책</th>
									<th>이름</th>
									<th>삭제</th>
								</tr>
							</thead>
							<tbody id="insertmembertbl">
								<th:block th:each="bussMemList : ${businessMemberList}">
									<tr th:id="${bussMemList.membId}">
										<td><img
											th:src="@{/images/profile/}+${bussMemList.membPhtPath}"
											height="50px" width="50px" alt="프로필"
											th:if="${bussMemList.membPhtPath != null}" /></td>
										<td th:text="${bussMemList.membDept}" />
										<td th:text="${bussMemList.membWkgd}" />
										<td th:text="${bussMemList.membNm}" />
										<!-- 버튼 수정하기 -->
										<td><i class="fa-solid fa-minus"></i></td>
									</tr>
								</th:block>
							</tbody>
						</table>
					</div>

				</div>
			</div>
			<div>
				<div class="card" style="height: 200px;">
					<div class="card-body" style="overflow: auto;">
						<div class="SearchBox" style="height: 50%">
							<label for="SearchToggleCheckBox"
								th:attr="onclick='searchMember()'"></label> <input type="hidden"
								id="keyword" value="전체">
							<div class="SearchInputBox" style="width: 270px;">
								<div>
									<div class="member-selectBox" style="width: 100px;">
										<div class="member-selected" id="member-selected">
											<div class="member-selected-value">전체</div>
											<div class="arrow"></div>
										</div>
										<ul class="member-select-ul"
											style="width: 100px; top: 20%; display: none;">
											<li class="member-select-option" data-value="전체">전체</li>
											<li class="member-select-option" data-value="부서">부서</li>
											<li class="member-select-option" data-value="직책">직책</li>
											<li class="member-select-option" data-value="제목">이름</li>
										</ul>
									</div>
								</div>
								<input class="SearchInputModalView" id="search" type="text"
									placeholder="검색어를 입력하세요.">
							</div>

						</div>
						<div class="table-responsive">
							<table class="table">
								<thead>
									<tr>
										<th>프로필</th>
										<th>부서</th>
										<th>직책</th>
										<th>이름</th>
										<th>추가</th>
									</tr>
								</thead>
								<tbody id="membertbl">
									<th:block th:each="memberList : ${memberList}">
										<tr th:id="${memberList.membId}">
											<td><img
												th:src="@{/images/profile/}+${memberList.membPhtPath}"
												height="50px" width="50px" alt="프로필"
												th:if="${memberList.membPhtPath != null}" /></td>
											<td th:text="${memberList.membDept}" />
											<td th:text="${memberList.membWkgd}" />
											<td th:text="${memberList.membNm}" />
											<!-- 버튼 수정하기 -->
											<td><i class="fa-solid fa-plus"></i></td>
										</tr>
									</th:block>
								</tbody>
							</table>
						</div>

					</div>
				</div>
			</div>
		</div>

		<div class="form-group row">
			<label class="col-lg-4 col-form-label">일정 </label>
			<div class="col-lg-3">
				<input type="date" class="form-control" id="bussFrdt"
					name="bussFrdt">
			</div>
			<div class="col-lg-1">
				<label class="col-lg-4 col-form-label">~ </label>

			</div>
			<div class="col-lg-3">
				<input type="date" class="form-control" id="bussTodt"
					name="bussTodt">
			</div>
		</div>

		<div class="form-group row">
			<label class="col-lg-4 col-form-label" for="val-username">중요도
			</label>
			<div class="col-lg-6">
				<div class="dropdown custom-dropdown">
					<select class="dropdown-import" id="bussImp" name="bussImp">
						<option class="dropdown-import" value="0J1">상</option>
						<option class="dropdown-import" value="0J2">중</option>
						<option class="dropdown-import" value="0J3">하</option>

					</select>

				</div>
			</div>
		</div>
		<div class="form-group row">
			<label class="col-lg-4 col-form-label" for="val-username">진척도
			</label>
			<div class="col-lg-6">
				<div style="padding-top: 10px; padding-bottom: 10px;">
					<div class="progress" style="height: 10px">
						<div class="progress-bar gradient-1" th:style="0"
							role="progressbar"></div>
					</div>
				</div>
			</div>
		</div>
		<div class="form-group row">
			<label class="col-lg-4 col-form-label" for="val-username">상태
			</label>
			<div class="col-lg-6">
				<input type="text" id="bussSt" value="" readonly="readonly" />
			</div>

		</div>
		<div class="form-group row">
			<label class="col-lg-4 col-form-label" for="val-username">종속관계
			</label>
			<div class="col-lg-6">
				<div class="dropdown custom-dropdown">
					<div>
						<select class="dropdown-relation" name="bussDep">
							<option class="dropdown-relation" value="">선택</option>
							<option class="dropdown-relation" value="up">선행 작업</option>
							<option class="dropdown-relation" value="down">후속 작업</option>

						</select>
					</div>
				</div>

				<div class="dropdown custom-dropdown">
					<div>
						<select class="dropdown-relation" name="bussUpNm">
							<option class="dropdown-business" value="">선택</option>
							<th:block th:each="bussNameList : ${businessNameList}">

								<option class="dropdown-business"
									th:value="${bussNameList.bussNm}"
									th:text="${bussNameList.bussNm}"></option>
							</th:block>
						</select>
					</div>
				</div>
			</div>
		</div>
	</div>
	<div>
		<input type="hidden" name="prjtNo" th:value="1" />
	</div>
	<div class="modal-footer">
		<button id="insertBtn" type="button" class="btn btn-primary">수정</button>
	</div>
</form>
<script>
	
	//$('.card-body.p-3').on('click', infoBusiness)

	$('.member-selectBox').on('click', function() {
		$('.member-select-ul').css('display', 'block');
	})

	$('.member-select-option').on('click', function(e) {

		var selectValue = e.currentTarget.textContent;
		$('.member-selected-value').text(selectValue);
		$('#keyword').val(selectValue);
		$('.member-select-ul').css('display', 'none');
		e.stopPropagation();
	})

	function infoBusiness(e) {

		//e.preventDefault();
		//let bussNm = $(this).find('a').text();
		const bussNo = $(this).find('input').val();
		let prjtNo = $('input[name=prjtNo]').val();
		//membId 세션값 넣어주기 let membId
		console.log(bussNo);
		$.ajax('/bussInfoAjax', {
			type : 'post',
			data : {
				bussNo : bussNo,
				prjtNo : prjtNo
			}
		}).done(
				function(data) {
					console.log(data);
					let bussSt = '';
					$('#bussNm').val(data.businessVO.bussNm);
					$('#bussFrdt').val(data.businessVO.bussFrdt);
					$('#bussTodt').val(data.businessVO.bussTodt);
					$('#bussImp').val(data.businessVO.bussImp).prop("selected",
							true);
					$('#bussDep').val(data.businessVO.bussDep).prop("selected",
							true);
					$('#bussUpNm').val(data.businessVO.bussUpNm).prop(
							"selected", true);
					$('#bussSt').val(data.businessVO.bussStNm);

					//업무 참여자 리스트 보여주기 
					let tbody = $('#updatemembertbl');
					$.each(data.businessMemberList, function(idx, data) {
						let trTag = $('<tr/>');
						let tdTag = $('<td/>');

						trTag.attr('id', data.membId);

						if (data.membPhtPath != null) {
							let imgTag = $('<img>', {
								src : "/images/profile/" + data.membPhtPath,
								height : "50px",
								width : "50px",
							})
							tdTag.append(imgTag);
						}
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append(data.membDept);
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append(data.membWkgd);
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append(data.membNm);
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append('<i class="fa-solid fa-minus"></i>');
						trTag.append(tdTag);

						tbody.append(trTag);

					})

					let memberbody = $('#membertbl2');
					$.each(data.memberList, function(idx, data) {
						let trTag = $('<tr/>');
						let tdTag = $('<td/>');

						trTag.attr('id', data.membId);

						if (data.membPhtPath != null) {
							let imgTag = $('<img>', {
								src : "/images/profile/" + data.membPhtPath,
								height : "50px",
								width : "50px",
							})
							tdTag.append(imgTag);
						}
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append(data.membDept);
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append(data.membWkgd);
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append(data.membNm);
						trTag.append(tdTag);

						tdTag = $('<td/>');
						tdTag.append('<i class="fa-solid fa-plus"></i>');
						trTag.append(tdTag);

						memberbody.append(trTag);

					})
				}).fail();

	}
</script>
